<?xml version="1.0" ?>
<tool id="pick_closed_reference_otus" name="pick closed reference otus" version="1.9.1">
	<description>Closed-reference OTU picking/Shotgun UniFrac workflow.</description>
	<requirements>
		<requirement type="package">qiime</requirement>
	</requirements>
	<command>pick_closed_reference_otus.py -i $input_fp -o pick_closed_reference_otus_output
#if str($reference_fp) != 'None':
 -r $reference_fp
#end if

#if str($parameter_fp) != 'None':
 -p $parameter_fp
#end if

#if str($taxonomy_fp) != 'None':
 -t $taxonomy_fp
#end if

#if $assign_taxonomy:
 -s
#end if

#if $parallel:
 -a
#end if

#if $jobs_to_start:
 -O $jobs_to_start
#end if

#if $suppress_taxonomy_assignment:
 --suppress_taxonomy_assignment
#end if
;
compress_path.py -i pick_closed_reference_otus_output -o $output_dir
</command>
	<inputs>
		<param label="-i/--input_fp: the input sequences" name="input_fp" optional="False" type="data"/>
		<param default="/Users/lparsons/.virtualenvs/qiime/lib/python2.7/site-packages/qiime_default_reference/gg_13_8_otus/rep_set/97_otus.fasta" label="-r/--reference_fp: The reference sequences [default: /Users/lparsons/.virtualenvs/qiime/lib/python2.7/site-packages/qiime_default_reference/gg_13_8_otus/rep_set/97_otus.fasta]. NOTE: If you do not pass -r to this script, you will be using QIIME's default reference sequences. In this case, QIIME will copy the corresponding reference tree to the output directory. This is the tree that should be used to perform phylogenetic diversity analyses (e.g., with core_diversity_analyses.py)." name="reference_fp" optional="True" type="data"/>
		<param label="-p/--parameter_fp: path to the parameter file, which specifies changes to the default behavior. See http://www.qiime.org/documentation/file_formats.html#qiime-parameters . [if omitted, default values will be used]" name="parameter_fp" optional="True" type="data"/>
		<param default="/Users/lparsons/.virtualenvs/qiime/lib/python2.7/site-packages/qiime_default_reference/gg_13_8_otus/taxonomy/97_otu_taxonomy.txt" label="-t/--taxonomy_fp: the taxonomy map [default: /Users/lparsons/.virtualenvs/qiime/lib/python2.7/site-packages/qiime_default_reference/gg_13_8_otus/taxonomy/97_otu_taxonomy.txt]" name="taxonomy_fp" optional="True" type="data"/>
		<param label="-s/--assign_taxonomy: Assign taxonomy to each sequence using assign_taxonomy.py (this will override --taxonomy_fp, if provided) [default: False]" name="assign_taxonomy" selected="False" type="boolean"/>
		<param label="-a/--parallel: Run in parallel where available [default: False]" name="parallel" selected="False" type="boolean"/>
		<param default="1" label="-O/--jobs_to_start: Number of jobs to start. NOTE: you must also pass -a to run in parallel, this defines the number of jobs to be started if and only if -a is passed [default: 1]" name="jobs_to_start" optional="True" type="integer"/>
		<param label="--suppress_taxonomy_assignment: skip the taxonomy assignment step, resulting in an OTU table without taxonomy (this will override --taxonomy_fp and --assign_taxonomy, if provided) [default: False]" name="suppress_taxonomy_assignment" selected="False" type="boolean"/>
	</inputs>
	<outputs>
		<data format="tgz" name="output_dir"/>
	</outputs>
	<help>
This script picks OTUs using a closed reference and constructs an OTU table.
Taxonomy is assigned using a pre-defined taxonomy map of reference sequence OTU
to taxonomy. If full-length genomes are provided as the reference sequences,
this script applies the Shotgun UniFrac method.

**Note:** If most or all of your sequences are failing to hit the reference,
your sequences may be in the reverse orientation with respect to your reference
database. To address this, you should add the following line to your parameters
file (creating one, if necessary) and pass this file as -p:

pick_otus:enable_rev_strand_match True

Be aware that this doubles the amount of memory used.


</help>
</tool>
